<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§ì› ê·¼ì†ê¸°ê°„ ê³„ì‚°ê¸°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .upload-section {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            border: 2px dashed #667eea;
            text-align: center;
        }
        .upload-section.dragover {
            background: #e6f0ff;
            border-color: #4a90e2;
        }
        input[type="file"] {
            margin: 10px 0;
            padding: 10px;
            font-size: 14px;
        }
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s ease;
        }
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(102, 126, 234, 0.4);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .info-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .preview-table th, .preview-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .preview-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
        }
        .preview-table tr:hover {
            background: #f5f7ff;
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
        }
        .stat-label {
            margin-top: 5px;
            opacity: 0.9;
        }
        .loading {
            text-align: center;
            margin: 20px 0;
        }
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š ì§ì› ê·¼ì†ê¸°ê°„ ê³„ì‚°ê¸°</h1>
        
        <div class="info-section">
            <h3>ğŸ“‹ ì‚¬ìš©ë°©ë²•</h3>
            <ol>
                <li><strong>ì§ì›ëª…ë¶€ CSV íŒŒì¼</strong>ì„ ì—…ë¡œë“œí•˜ì„¸ìš” (ì‚¬ë²ˆ, ì„±ëª…, ìµœì´ˆì…ì‚¬ì¼ ì»¬ëŸ¼ í•„ìš”)</li>
                <li>ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ê²Œ ë¡œë“œë˜ì—ˆëŠ”ì§€ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ í™•ì¸í•˜ì„¸ìš”</li>
                <li><strong>"ì—‘ì…€ íŒŒì¼ ë‹¤ìš´ë¡œë“œ"</strong> ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ê·¼ì†ê¸°ê°„ì´ ê³„ì‚°ëœ ì—‘ì…€ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”</li>
                <li>ê·¼ì†ê¸°ê°„ì€ <strong>2024ë…„ 12ì›” 31ì¼ ê¸°ì¤€</strong>ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤</li>
                <li>ê·¼ì†ê¸°ê°„ì€ <strong>ë‘ ê°€ì§€ í˜•ì‹</strong>ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤: "Xë…„ Xê°œì›” Xì¼" í˜•ì‹ê³¼ ì´ ê°œì›” ìˆ˜</li>
            </ol>
        </div>

        <div class="upload-section" id="uploadSection">
            <h3>ğŸ“ CSV íŒŒì¼ ì—…ë¡œë“œ</h3>
            <p>ì§ì›ëª…ë¶€.csv íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”</p>
            <input type="file" id="csvFile" accept=".csv" />
            <button onclick="loadSampleData()">ìƒ˜í”Œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸</button>
        </div>

        <div id="status"></div>
        
        <div id="stats" class="stats" style="display:none;"></div>
        
        <div id="preview" style="display:none;">
            <h3>ğŸ“Š ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° (ìƒìœ„ 10ê°œ í–‰)</h3>
            <div style="overflow-x: auto;">
                <table class="preview-table" id="previewTable">
                    <thead id="tableHeader"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
            <button id="downloadBtn" onclick="downloadExcel()" disabled>
                ğŸ’¾ ì—‘ì…€ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            </button>
        </div>
    </div>

    <script>
        let employeeData = [];
        let processedData = [];

        // íŒŒì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
        const uploadSection = document.getElementById('uploadSection');
        const fileInput = document.getElementById('csvFile');

        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('dragover');
        });

        uploadSection.addEventListener('dragleave', () => {
            uploadSection.classList.remove('dragover');
        });

        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileUpload();
            }
        });

        fileInput.addEventListener('change', handleFileUpload);

        function showStatus(message, type = 'success') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function showLoading(message) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="loading">${message}</div>`;
        }

        function handleFileUpload() {
            const file = fileInput.files[0];
            if (!file) return;

            showLoading('íŒŒì¼ì„ ì½ëŠ” ì¤‘...');

            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                parseCSV(csv);
            };
            reader.readAsText(file, 'UTF-8');
        }

        function parseCSV(csvText) {
            try {
                const results = Papa.parse(csvText, {
                    header: true,
                    dynamicTyping: true,
                    skipEmptyLines: true,
                    encoding: 'UTF-8'
                });

                if (results.errors.length > 0) {
                    console.warn('CSV íŒŒì‹± ê²½ê³ :', results.errors);
                }

                employeeData = results.data;
                
                // í•„ìˆ˜ ì»¬ëŸ¼ í™•ì¸
                const requiredColumns = ['ì‚¬ë²ˆ', 'ì„±ëª…', 'ìµœì´ˆì…ì‚¬ì¼'];
                const columns = results.meta.fields;
                const missingColumns = requiredColumns.filter(col => !columns.includes(col));
                
                if (missingColumns.length > 0) {
                    showStatus(`âŒ í•„ìˆ˜ ì»¬ëŸ¼ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤: ${missingColumns.join(', ')}`, 'error');
                    return;
                }

                // ê·¼ì†ê¸°ê°„ ê³„ì‚°
                calculateTenure();
                displayData();
                showStatus(`âœ… ì´ ${employeeData.length}ëª…ì˜ ì§ì› ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!`);
                
            } catch (error) {
                showStatus(`âŒ íŒŒì¼ íŒŒì‹± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
            }
        }

        function calculateTenure() {
            const endDate = new Date('2024-12-31');
            
            processedData = employeeData.map(employee => {
                const startDate = new Date(employee.ìµœì´ˆì…ì‚¬ì¼);
                const tenure = getDateDifference(startDate, endDate);
                
                return {
                    ì‚¬ë²ˆ: employee.ì‚¬ë²ˆ,
                    ì„±ëª…: employee.ì„±ëª…,
                    ìµœì´ˆì…ì‚¬ì¼: employee.ìµœì´ˆì…ì‚¬ì¼,
                    'ê·¼ì†ê¸°ê°„(2024ë…„ë§ê¸°ì¤€)': tenure
                };
            });
        }

        function getDateDifference(startDate, endDate) {
            let years = endDate.getFullYear() - startDate.getFullYear();
            let months = endDate.getMonth() - startDate.getMonth();
            let days = endDate.getDate() - startDate.getDate();

            if (days < 0) {
                months--;
                const lastMonth = new Date(endDate.getFullYear(), endDate.getMonth(), 0);
                days += lastMonth.getDate();
            }

            if (months < 0) {
                years--;
                months += 12;
            }

            let tenureStr = '';
            if (years > 0) tenureStr += `${years}ë…„ `;
            if (months > 0) tenureStr += `${months}ê°œì›” `;
            if (days > 0) tenureStr += `${days}ì¼`;

            return tenureStr.trim() || '1ì¼';
        }

        function displayData() {
            // í†µê³„ í‘œì‹œ
            displayStats();
            
            // í…Œì´ë¸” í—¤ë”
            const header = document.getElementById('tableHeader');
            header.innerHTML = `
                <tr>
                    <th>ì‚¬ë²ˆ</th>
                    <th>ì„±ëª…</th>
                    <th>ìµœì´ˆì…ì‚¬ì¼</th>
                    <th>ê·¼ì†ê¸°ê°„(2024ë…„ë§ê¸°ì¤€)</th>
                </tr>
            `;

            // í…Œì´ë¸” ë³¸ë¬¸ (ìƒìœ„ 10ê°œë§Œ í‘œì‹œ)
            const tbody = document.getElementById('tableBody');
            const displayData = processedData.slice(0, 10);
            
            tbody.innerHTML = displayData.map(employee => `
                <tr>
                    <td>${employee.ì‚¬ë²ˆ}</td>
                    <td>${employee.ì„±ëª…}</td>
                    <td>${employee.ìµœì´ˆì…ì‚¬ì¼}</td>
                    <td>${employee['ê·¼ì†ê¸°ê°„(2024ë…„ë§ê¸°ì¤€)']}</td>
                </tr>
            `).join('');

            document.getElementById('preview').style.display = 'block';
            document.getElementById('downloadBtn').disabled = false;
        }

        function displayStats() {
            const statsDiv = document.getElementById('stats');
            const totalEmployees = processedData.length;
            
            // ê·¼ì†ê¸°ê°„ë³„ ë¶„ì„
            const tenureAnalysis = analyzeTenure();
            
            statsDiv.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalEmployees}</div>
                    <div class="stat-label">ì´ ì§ì› ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${tenureAnalysis.over5Years}</div>
                    <div class="stat-label">5ë…„ ì´ìƒ ê·¼ì†</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${tenureAnalysis.over10Years}</div>
                    <div class="stat-label">10ë…„ ì´ìƒ ê·¼ì†</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${tenureAnalysis.avgYears.toFixed(1)}ë…„</div>
                    <div class="stat-label">í‰ê·  ê·¼ì†ê¸°ê°„</div>
                </div>
            `;
            
            statsDiv.style.display = 'grid';
        }

        function analyzeTenure() {
            let over5Years = 0;
            let over10Years = 0;
            let totalYears = 0;

            processedData.forEach(employee => {
                const startDate = new Date(employee.ìµœì´ˆì…ì‚¬ì¼);
                const endDate = new Date('2024-12-31');
                const years = endDate.getFullYear() - startDate.getFullYear();
                
                totalYears += years;
                if (years >= 5) over5Years++;
                if (years >= 10) over10Years++;
            });

            return {
                over5Years,
                over10Years,
                avgYears: totalYears / processedData.length
            };
        }

        function downloadExcel() {
            if (processedData.length === 0) {
                showStatus('âŒ ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            showLoading('ì—‘ì…€ íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ì¤‘...');

            try {
                // ì›Œí¬ë¶ ìƒì„±
                const workbook = XLSX.utils.book_new();

                // ì›Œí¬ì‹œíŠ¸ ë°ì´í„° ì¤€ë¹„
                const worksheetData = [
                    ['ì‚¬ë²ˆ', 'ì„±ëª…', 'ìµœì´ˆì…ì‚¬ì¼', 'ê·¼ì†ê¸°ê°„(2024ë…„ë§ê¸°ì¤€)'],
                    ...processedData.map(row => [
                        row.ì‚¬ë²ˆ,
                        row.ì„±ëª…,
                        row.ìµœì´ˆì…ì‚¬ì¼,
                        row['ê·¼ì†ê¸°ê°„(2024ë…„ë§ê¸°ì¤€)']
                    ])
                ];

                // ì›Œí¬ì‹œíŠ¸ ìƒì„±
                const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);

                // ì—´ ë„ˆë¹„ ì„¤ì •
                worksheet['!cols'] = [
                    { width: 10 }, // ì‚¬ë²ˆ
                    { width: 15 }, // ì„±ëª…
                    { width: 15 }, // ìµœì´ˆì…ì‚¬ì¼
                    { width: 25 }  // ê·¼ì†ê¸°ê°„
                ];

                // ì›Œí¬ì‹œíŠ¸ë¥¼ ì›Œí¬ë¶ì— ì¶”ê°€
                XLSX.utils.book_append_sheet(workbook, worksheet, 'ì§ì›ê·¼ì†ê¸°ê°„');

                // íŒŒì¼ëª… ìƒì„±
                const today = new Date().toISOString().split('T')[0];
                const filename = `ì§ì›ê·¼ì†ê¸°ê°„_2024ë…„ë§ê¸°ì¤€_${today}.xlsx`;

                // ì—‘ì…€ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                XLSX.writeFile(workbook, filename);

                showStatus(`âœ… ì—‘ì…€ íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤! (${filename})`);

            } catch (error) {
                showStatus(`âŒ ì—‘ì…€ íŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
            }
        }

        function loadSampleData() {
            const sampleCSV = `ì‚¬ë²ˆ,ì„±ëª…,ìµœì´ˆì…ì‚¬ì¼
1001,ê¹€ì² ìˆ˜,2020-03-15
1002,ì´ì˜í¬,2019-07-22
1003,ë°•ë¯¼ìˆ˜,2021-01-10
1004,ì •ë¯¸ë¼,2018-11-05
1005,ìµœì¤€í˜¸,2022-09-01
1006,í™ê¸¸ë™,2017-06-30
1007,ê¹€ë¯¸ì˜,2023-02-14
1008,ì´ë™ìˆ˜,2016-12-01
1009,ë°•ì„œì—°,2020-08-25
1010,ìµœìœ ì§„,2019-04-18`;

            parseCSV(sampleCSV);
            showStatus('âœ… ìƒ˜í”Œ ë°ì´í„°ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ì‚¬ìš©í•´ë³´ì„¸ìš”!');
        }
    </script>
</body>
</html>